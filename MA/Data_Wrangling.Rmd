---
title: "Data_Wrangling"
author: "Paul Apivat Hanvongse"
date: "8/25/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Setup: Review

We covered a fair amount last time, we'll re-run some code to get setup:

```{r, include=FALSE}
# Take note of our software environment
sessionInfo()

# Load Libraries & Packages
library(tidyverse)
library(readxl)

# Read Data, Assign to Data Object
data <- read_xlsx("./data/sdg_goal_4.4.xlsx")
glimpse(data)

# Use another function, similar to glimpse() to explore

# Your Turn: Read data, assign to data_clmv
# use read_xlsx() function
data_clmv <- 


```

## Review

We covered effficient ways to find all **missing values**. 

```{r, include=FALSE}
# What is a more efficient way to find missing value for data all at once?
data %>%
    summarize_all(~ sum(is.na(.))) 
    # Output results of this operation in spreadsheet view.

# What are the rows with missing data?

```

## Data Wrangling: Selecting

Having explored our data, we're now ready to wrangle our data. Data wrangling, similar to wrestling, is doing various operations **to** the data to answer questions we have about the data. 

```{r,include=FALSE}

# We saw all the columns with missing data
# De-select those columns with missing values, we will not use them in the subsequent analysis

data %>%
    select(-TimeCoverage, 
           -UpperBound, 
           -LowerBound, 
           -BasePeriod, 
           -GeoInfoUrl, 
           -FootNote, 
           -Nature) %>%
    view()

# Alternatively, Instead of de-select, select columns you're interested in
data %>%
    select(GeoAreaName, 
           Value, 
           Units, 
           Sex, 
           `Type of skill`, 
           TimePeriod, 
           Time_Detail) %>%
    view()

# What TYPE of variables have we selected? This gives us a clue as to how to proceed

data %>%
    select(GeoAreaName, Value, Units, Sex, `Type of skill`, TimePeriod, Time_Detail) %>%
    # also try summary()
    str()


# Note: through piping (%>%) we can combine new functions (select) with previous functions we learned (str)



```

## Data Wrangling: Mutate

We were not able to see `Value` - why? What can we do? Oftentime, we'll need to change the **data type** of a variable, similar to how we change **vectors** to **tibble / data frame**, BEFORE we could do any visualization operations.  

We'll note that even though we're in the exploration / wrangling phase, we'll use visualization to help us make sense of the data. 

Note the distinction between visualizing *for yourself* vs visualization *for others*. 


```{r, include=FALSE}
# Quick Review

# Atomic Vectors
# Try visualizing BEFORE turning into Tibble
inclass_sample_data <- c(3,4,7,2,8,10,7,4,5,6,12,15,11,8,5,9,13,10)
inclass_sample_data_1 <- c(3,4,7,2,8,10,7,4,5,6,12,15,11,8,5,9,13,50000)

# Vectors into Tibble
inclass_sample_data <- as.tibble(inclass_sample_data)
inclass_sample_data_1 <- as.tibble(inclass_sample_data_1)

# Intro to visualization (for detecting outliers)
inclass_sample_data %>%
    ggplot(aes(x = value)) +
    geom_boxplot()

# With outliers
inclass_sample_data_1 %>%
    ggplot(aes(x = value)) +
    geom_boxplot()

# Mutate allows us to change the variable type within a piping operation
# highlight before mutate to see Value data type before, then after
data %>%
    select(GeoAreaName, Value, Units, Sex, `Type of skill`, TimePeriod) %>%
    mutate(
        Value = as.numeric(Value)
    )

# Note: We took out Time_Detail, leaving only TimePeriod why? Try adding it back above to see.

# Examine Outliers within Data, in the Value column

data %>%
    select(GeoAreaName, Value, Units, Sex, `Type of skill`, TimePeriod) %>%
    mutate(
        Value = as.numeric(Value)
    ) %>%
    # quick way to get distribution of numerical variables
    summary()

# visually explore outliers in Value
# also try geom_histogram
data %>%
    select(GeoAreaName, Value, Units, Sex, `Type of skill`, TimePeriod) %>%
    mutate(
        Value = as.numeric(Value)
    ) %>%
    ggplot(aes(x = Value)) +
    geom_boxplot()

```

## Data Wrangling: Subsetting through filter()

Now that we've examined potential outliers (and found none), we might want to **subset** our data to make our work (i.e., exploring/analyzing/visualizing) more *manageable*. 

We can begin asking specific questions of our data. What if we wanted to find proportion of Youth/Adult with ICT skills by Country & Gender?

We'll quickly find that we need more specific questions with `filter()`

# NOTE: Get re-acquainted with meta-data. 


```{r,include=FALSE}

# We need more specific questions. We can do this by using filter()

# What if we wanted proportion of Gender & ICT Skills for Thailand in 2018?

data %>%
    # select specific columns (de-select others)
    select(GeoAreaName, Value, Sex, `Type of skill`, TimePeriod) %>%
    # rename column
    rename(type_of_skill = `Type of skill`) %>%
    # mutate creates new column
    mutate(
        Value = as.double(Value)
    ) %>%
     # filter on condition within parentheses
    filter(GeoAreaName == 'Thailand') %>% 
    filter(TimePeriod == 2018) %>% 
    arrange(desc(Value))

# NOTE: Here we see that for Thailand in 2018, in terms of ICT SKills and Gender, the highest proportion were Women and the COPA skill. Followed closely by WOmen and CMFL skill. 

```

## Data Wrangling: Aggregate data by using group_by() and summarize()

Previously, by filtering for GeoAreaName ("Thailand") and TimePeriod ("2018"), we saw detailed ranking of proportion of population with sub-types of ICT Skill and gender. Perhaps we want to step back and look at data in the **aggregate**.

# NOTE: Get re-acquainted with meta-data. 

```{r,include=FALSE}

# What if we SUM across Gender (Male, Female, Bothsex), we want to look at the aggregate proportion ranked by ICT Skills, for Thailand in 2018?


data %>%
    # select specific columns (de-select others)
    select(GeoAreaName, Value, Sex, `Type of skill`, TimePeriod) %>%
    # rename column
    rename(type_of_skill = `Type of skill`) %>%
    # mutate creates new column
    mutate(
        Value = as.double(Value)
    ) %>%
     # filter on condition within parentheses
    filter(GeoAreaName == 'Thailand') %>% 
    filter(TimePeriod == 2018) %>% 
    # group_by
    group_by(type_of_skill) %>%
    summarize(
        sum_value = sum(Value)
    ) %>%
    # arrange
    arrange(desc(sum_value))
```

## Outliers Review / Appendix

We also looked out **outliers** and, in the process, covered the difference between **vectors** and **data frames (tibbles)**.

```{r, include=FALSE}

# Atomic Vectors
inclass_sample_data <- c(3,4,7,2,8,10,7,4,5,6,12,15,11,8,5,9,13,10)
inclass_sample_data_1 <- c(3,4,7,2,8,10,7,4,5,6,12,15,11,8,5,9,13,50000)

# Vectors into Tibble
inclass_sample_data <- as.tibble(inclass_sample_data)
inclass_sample_data_1 <- as.tibble(inclass_sample_data_1)

# Intro to visualization (for detecting outliers)
inclass_sample_data %>%
    ggplot(aes(x = value)) +
    geom_boxplot()

# With outliers
inclass_sample_data_1 %>%
    ggplot(aes(x = value)) +
    geom_boxplot()

```
